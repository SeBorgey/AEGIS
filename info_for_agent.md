## Обзор проекта AEGIS

AEGIS — Autonomous Engineering and Generation Intelligence System. Это экспериментальный инструмент для автоматической генерации, тестирования и упаковки Python-приложений с помощью LLM (моделей типа Gemini/OpenAI). Проект содержит агента, который формирует промпты, генерирует код через LLM, прогоняет его в headless-режиме и пытается упаковать результат с помощью PyInstaller.

Цель этого документа — собрать для ассистента (и разработчиков) компактный, но исчерпывающий обзор проекта: архитектуру, ключевые модули, способ запуска, заметки по безопасности и дальнейшие задачи.

## Ключевые компоненты

- `main.py` — запускной скрипт, который читает задачи из `datasets/*` и инициализирует `ProgrammingAgent`, `LLMClient` и `CodeExecutor`.
- `agent.py` — `ProgrammingAgent`: формирует системные и пользовательские промпты, запрашивает генерацию кода, запускает headless-тест и при успешном результате запускает упаковку.
- `llm_client.py` — обёртка для вызовов LLM API (используется клиент `openai.OpenAI` с базовым URL, вероятно для Google generative API). Вытягивает блоки кода из ответа (ищет ```python ... ```).
- `code_executor.py` — сохраняет код, запускает headless-тест (устанавливает `QT_QPA_PLATFORM=offscreen`), пытается автоматически установить отсутствующие пакеты при ошибке `ModuleNotFoundError`, упаковывает приложение через PyInstaller.
- `action_api/` — простой каркас для выполнения действий: чтение/создание/редактирование файлов и запуск терминальных команд через набор `ActionResult`/`ActionCall`. Содержит:
  - `registry.py` — собирает словарь доступных действий.
  - `actions/file.py` — операции с файловой системой (`read_file`, `create_file`, `edit_file`).
  - `actions/terminal.py` — запуск команд (обёртка вокруг `subprocess.run`).
  - `models.py` — Pydantic-модели `ActionCall` и `ActionResult`.

## Структура репозитория (важные точки)

- `agent.py`
- `code_executor.py`
- `llm_client.py`
- `main.py`
- `run.sh` — пример запуска (содержит экспорт `OPENAI_API_KEY` и старт `python -u main.py`).
- `pyproject.toml` — указывает `requires-python = ">=3.11"` и пустой список зависимостей.
- `datasets/` — набор JSON с заданиями: `easy.json`, `middle.json`.
- `action_api/` — модуль с API действий (см. выше).

- `log_manager.py` — утилита логирования: создаёт отдельную папку для каждого запуска внутри `logs/` (по умолчанию), ведёт два файла в папке: `program.log` (детальные логи, также вывод в stdout) и `chat.md` (полный чат с моделью в Markdown). Поддерживает простую политику удержания старых запусков по дате (retention_days) и предоставляет функцию `setup_logging(base_dir, retention_days, logger_name)` -> `(LogManager, logging.Logger)`.

## Поведение агента и сценарии использования

- Агент формирует системный промпт с требованием: весь код в одном файле, использовать PySide6, не добавлять комментариев, возвращать только блок кода.
- После генерации код сохраняется и запускается короткий headless-тест (3 секунды). Если процесс завершается ошибкой, агент отправляет LLM код и стек-трейс и просит исправить.
- При успехе агент пытается упаковать приложение PyInstaller'ом.

---

Файл сгенерирован автоматически ассистентом для внутреннего использования
